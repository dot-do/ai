---
$id: https://integrations.do/salesforce
$type: Integration
name: Salesforce
service: salesforce
description: Customer relationship management platform for sales, service, marketing, and commerce
category: crm
sdkBased: true
sdkPackage: jsforce
sdkVersion: ^3.4.1
sdkImport: jsforce

auth:
  type: oauth2
  oauth2:
    authorizationUrl: https://login.salesforce.com/services/oauth2/authorize
    tokenUrl: https://login.salesforce.com/services/oauth2/token
    scopes:
      - api
      - refresh_token
      - full
    grantType: authorization_code

apiVersion: '60.0'

resources:
  - name: Account
    plural: Accounts
    sdkPath: sobject('Account')
    description: Business account records
    operations:
      - name: create
        method: create
        params:
          - name: params
            type: object
            required: true
            description: Account creation parameters (Name, Type, Industry, etc.)
        returns: object

      - name: get
        method: retrieve
        params:
          - name: id
            type: string
            required: true
            description: Account ID (18-character Salesforce ID)
        returns: object

      - name: update
        method: update
        params:
          - name: id
            type: string
            required: true
            description: Account ID
          - name: params
            type: object
            required: true
            description: Update parameters
        returns: object

      - name: delete
        method: delete
        params:
          - name: id
            type: string
            required: true
            description: Account ID
        returns: boolean

      - name: list
        method: query
        params:
          - name: options
            type: object
            required: false
            description: List options (type, industry, limit, orderBy, etc.)
        returns: object
        pagination:
          type: offset
          limitParam: limit
          offsetParam: offset

      - name: search
        method: search
        params:
          - name: searchTerm
            type: string
            required: true
            description: Search term for SOSL query
        returns: array

  - name: Contact
    plural: Contacts
    sdkPath: sobject('Contact')
    description: Individual contact records
    operations:
      - name: create
        method: create
        params:
          - name: params
            type: object
            required: true
            description: Contact creation parameters (FirstName, LastName, Email, AccountId, etc.)
        returns: object

      - name: get
        method: retrieve
        params:
          - name: id
            type: string
            required: true
            description: Contact ID
        returns: object

      - name: update
        method: update
        params:
          - name: id
            type: string
            required: true
            description: Contact ID
          - name: params
            type: object
            required: true
            description: Update parameters
        returns: object

      - name: delete
        method: delete
        params:
          - name: id
            type: string
            required: true
            description: Contact ID
        returns: boolean

      - name: list
        method: query
        params:
          - name: options
            type: object
            required: false
            description: List options (accountId, limit, orderBy, etc.)
        returns: object
        pagination:
          type: offset
          limitParam: limit
          offsetParam: offset

      - name: search
        method: search
        params:
          - name: searchTerm
            type: string
            required: true
            description: Search term for SOSL query
        returns: array

  - name: Lead
    plural: Leads
    sdkPath: sobject('Lead')
    description: Lead records for prospective customers
    operations:
      - name: create
        method: create
        params:
          - name: params
            type: object
            required: true
            description: Lead creation parameters (FirstName, LastName, Company, Status, etc.)
        returns: object

      - name: get
        method: retrieve
        params:
          - name: id
            type: string
            required: true
            description: Lead ID
        returns: object

      - name: update
        method: update
        params:
          - name: id
            type: string
            required: true
            description: Lead ID
          - name: params
            type: object
            required: true
            description: Update parameters
        returns: object

      - name: delete
        method: delete
        params:
          - name: id
            type: string
            required: true
            description: Lead ID
        returns: boolean

      - name: convert
        method: convertLead
        params:
          - name: options
            type: object
            required: true
            description: Lead conversion options (leadId, convertedStatus, doNotCreateOpportunity, etc.)
        returns: object

      - name: list
        method: query
        params:
          - name: options
            type: object
            required: false
            description: List options (status, rating, limit, orderBy, etc.)
        returns: object
        pagination:
          type: offset
          limitParam: limit
          offsetParam: offset

  - name: Opportunity
    plural: Opportunities
    sdkPath: sobject('Opportunity')
    description: Sales opportunity records
    operations:
      - name: create
        method: create
        params:
          - name: params
            type: object
            required: true
            description: Opportunity creation parameters (Name, AccountId, StageName, CloseDate, Amount, etc.)
        returns: object

      - name: get
        method: retrieve
        params:
          - name: id
            type: string
            required: true
            description: Opportunity ID
        returns: object

      - name: update
        method: update
        params:
          - name: id
            type: string
            required: true
            description: Opportunity ID
          - name: params
            type: object
            required: true
            description: Update parameters
        returns: object

      - name: delete
        method: delete
        params:
          - name: id
            type: string
            required: true
            description: Opportunity ID
        returns: boolean

      - name: list
        method: query
        params:
          - name: options
            type: object
            required: false
            description: List options (accountId, stageName, limit, orderBy, etc.)
        returns: object
        pagination:
          type: offset
          limitParam: limit
          offsetParam: offset

  - name: Case
    plural: Cases
    sdkPath: sobject('Case')
    description: Customer service case records
    operations:
      - name: create
        method: create
        params:
          - name: params
            type: object
            required: true
            description: Case creation parameters (Subject, Description, Status, Priority, AccountId, etc.)
        returns: object

      - name: get
        method: retrieve
        params:
          - name: id
            type: string
            required: true
            description: Case ID
        returns: object

      - name: update
        method: update
        params:
          - name: id
            type: string
            required: true
            description: Case ID
          - name: params
            type: object
            required: true
            description: Update parameters
        returns: object

      - name: delete
        method: delete
        params:
          - name: id
            type: string
            required: true
            description: Case ID
        returns: boolean

      - name: list
        method: query
        params:
          - name: options
            type: object
            required: false
            description: List options (accountId, status, priority, limit, orderBy, etc.)
        returns: object
        pagination:
          type: offset
          limitParam: limit
          offsetParam: offset

  - name: Task
    plural: Tasks
    sdkPath: sobject('Task')
    description: Activity task records
    operations:
      - name: create
        method: create
        params:
          - name: params
            type: object
            required: true
            description: Task creation parameters (Subject, Status, Priority, ActivityDate, WhoId, WhatId, etc.)
        returns: object

      - name: get
        method: retrieve
        params:
          - name: id
            type: string
            required: true
            description: Task ID
        returns: object

      - name: update
        method: update
        params:
          - name: id
            type: string
            required: true
            description: Task ID
          - name: params
            type: object
            required: true
            description: Update parameters
        returns: object

      - name: delete
        method: delete
        params:
          - name: id
            type: string
            required: true
            description: Task ID
        returns: boolean

      - name: list
        method: query
        params:
          - name: options
            type: object
            required: false
            description: List options (status, priority, limit, orderBy, etc.)
        returns: object
        pagination:
          type: offset
          limitParam: limit
          offsetParam: offset

  - name: CustomObject
    plural: CustomObjects
    sdkPath: sobject
    description: Generic custom object operations
    operations:
      - name: create
        method: create
        params:
          - name: objectType
            type: string
            required: true
            description: Custom object API name (e.g., 'CustomObject__c')
          - name: params
            type: object
            required: true
            description: Record data
        returns: object

      - name: get
        method: retrieve
        params:
          - name: objectType
            type: string
            required: true
            description: Custom object API name
          - name: id
            type: string
            required: true
            description: Record ID
        returns: object

      - name: update
        method: update
        params:
          - name: objectType
            type: string
            required: true
            description: Custom object API name
          - name: id
            type: string
            required: true
            description: Record ID
          - name: params
            type: object
            required: true
            description: Record data
        returns: object

      - name: delete
        method: delete
        params:
          - name: objectType
            type: string
            required: true
            description: Custom object API name
          - name: id
            type: string
            required: true
            description: Record ID
        returns: boolean

  - name: Query
    plural: Queries
    sdkPath: query
    description: SOQL query execution
    operations:
      - name: execute
        method: query
        params:
          - name: soql
            type: string
            required: true
            description: SOQL query string
        returns: object

      - name: queryMore
        method: queryMore
        params:
          - name: nextRecordsUrl
            type: string
            required: true
            description: Next records URL from previous query result
        returns: object

  - name: Search
    plural: Searches
    sdkPath: search
    description: SOSL search execution
    operations:
      - name: execute
        method: search
        params:
          - name: sosl
            type: string
            required: true
            description: SOSL search string
        returns: array

  - name: Bulk
    plural: BulkOperations
    sdkPath: bulk.load
    description: Bulk API operations for large datasets
    operations:
      - name: insert
        method: load
        params:
          - name: objectType
            type: string
            required: true
            description: Object type
          - name: records
            type: array
            required: true
            description: Array of records to insert (up to 10,000)
        returns: array

      - name: update
        method: load
        params:
          - name: objectType
            type: string
            required: true
            description: Object type
          - name: records
            type: array
            required: true
            description: Array of records to update
        returns: array

      - name: delete
        method: load
        params:
          - name: objectType
            type: string
            required: true
            description: Object type
          - name: records
            type: array
            required: true
            description: Array of records with IDs to delete
        returns: array

  - name: Metadata
    plural: Metadata
    sdkPath: describe
    description: Object and field metadata introspection
    operations:
      - name: describeObject
        method: describe
        params:
          - name: objectType
            type: string
            required: true
            description: Object type to describe
        returns: object

      - name: describeGlobal
        method: describeGlobal
        params: []
        returns: object

webhooks:
  enabled: true
  signatureHeader: X-Salesforce-Signature
  signatureAlgorithm: sha256
  verificationMethod: signature
  events:
    - name: account.created
      type: Account:created
      description: Occurs when a new account is created
    - name: account.updated
      type: Account:updated
      description: Occurs when an account is updated
    - name: account.deleted
      type: Account:deleted
      description: Occurs when an account is deleted
    - name: contact.created
      type: Contact:created
      description: Occurs when a new contact is created
    - name: contact.updated
      type: Contact:updated
      description: Occurs when a contact is updated
    - name: contact.deleted
      type: Contact:deleted
      description: Occurs when a contact is deleted
    - name: lead.created
      type: Lead:created
      description: Occurs when a new lead is created
    - name: lead.updated
      type: Lead:updated
      description: Occurs when a lead is updated
    - name: lead.deleted
      type: Lead:deleted
      description: Occurs when a lead is deleted
    - name: lead.converted
      type: Lead:converted
      description: Occurs when a lead is converted to account, contact, and opportunity
    - name: opportunity.created
      type: Opportunity:created
      description: Occurs when a new opportunity is created
    - name: opportunity.updated
      type: Opportunity:updated
      description: Occurs when an opportunity is updated
    - name: opportunity.deleted
      type: Opportunity:deleted
      description: Occurs when an opportunity is deleted
    - name: case.created
      type: Case:created
      description: Occurs when a new case is created
    - name: case.updated
      type: Case:updated
      description: Occurs when a case is updated
    - name: case.deleted
      type: Case:deleted
      description: Occurs when a case is deleted
    - name: task.created
      type: Task:created
      description: Occurs when a new task is created
    - name: task.updated
      type: Task:updated
      description: Occurs when a task is updated
    - name: task.deleted
      type: Task:deleted
      description: Occurs when a task is deleted
    - name: platform_event
      type: platform_event
      description: Custom platform event
    - name: change_data_capture
      type: change_data_capture
      description: Change data capture event for real-time updates

errors:
  mapping:
    - code: INVALID_SESSION_ID
      type: authentication
      statusCode: 401
      message: Session expired or invalid - please re-authenticate
      retryable: false
    - code: INVALID_LOGIN
      type: authentication
      statusCode: 401
      message: Invalid username, password, security token, or user locked out
      retryable: false
    - code: AUTHENTICATION_FAILED
      type: authentication
      statusCode: 401
      message: Authentication failed
      retryable: false
    - code: OAUTH_ERROR
      type: authentication
      statusCode: 401
      message: OAuth authentication error
      retryable: false
    - code: QUERY_TIMEOUT
      type: server
      statusCode: 408
      message: Query exceeded time limit
      retryable: true
    - code: MALFORMED_QUERY
      type: validation
      statusCode: 400
      message: Query syntax is invalid
      retryable: false
    - code: INVALID_FIELD
      type: validation
      statusCode: 400
      message: Field does not exist or is not accessible
      retryable: false
    - code: DUPLICATE_VALUE
      type: validation
      statusCode: 400
      message: Duplicate value found for unique field
      retryable: false
    - code: REQUIRED_FIELD_MISSING
      type: validation
      statusCode: 400
      message: Required field is missing
      retryable: false
    - code: FIELD_CUSTOM_VALIDATION_EXCEPTION
      type: validation
      statusCode: 400
      message: Custom validation rule failed
      retryable: false
    - code: STRING_TOO_LONG
      type: validation
      statusCode: 400
      message: String value is too long for the field
      retryable: false
    - code: INVALID_FIELD_FOR_INSERT_UPDATE
      type: validation
      statusCode: 400
      message: Field is not editable
      retryable: false
    - code: ENTITY_IS_DELETED
      type: not_found
      statusCode: 404
      message: Record has been deleted
      retryable: false
    - code: INVALID_ID_FIELD
      type: not_found
      statusCode: 404
      message: Invalid ID format or ID does not exist
      retryable: false
    - code: ENTITY_IS_LOCKED
      type: server
      statusCode: 423
      message: Record is locked by an approval process or another user
      retryable: false
    - code: INSUFFICIENT_ACCESS_ON_CROSS_REFERENCE_ENTITY
      type: authorization
      statusCode: 403
      message: Insufficient permissions to access this record
      retryable: false
    - code: INSUFFICIENT_ACCESS
      type: authorization
      statusCode: 403
      message: Insufficient permissions
      retryable: false
    - code: NO_ACCESS
      type: authorization
      statusCode: 403
      message: No access to resource
      retryable: false
    - code: REQUEST_LIMIT_EXCEEDED
      type: rate_limit
      statusCode: 429
      message: API request limit exceeded
      retryable: true
    - code: API_CURRENTLY_DISABLED
      type: server
      statusCode: 503
      message: API is currently disabled
      retryable: true
    - code: INVALID_TYPE
      type: validation
      statusCode: 400
      message: Invalid object type
      retryable: false
    - code: BATCH_PROCESSING_ERROR
      type: server
      statusCode: 500
      message: Bulk batch processing error
      retryable: true
    - code: BATCH_LIMIT_EXCEEDED
      type: rate_limit
      statusCode: 429
      message: Bulk batch limit exceeded
      retryable: true
    - code: CONNECTION_ERROR
      type: network
      statusCode: 500
      message: Connection to Salesforce failed
      retryable: true
    - code: TIMEOUT_ERROR
      type: network
      statusCode: 408
      message: Request timed out
      retryable: true
    - code: UNKNOWN_ERROR
      type: unknown
      statusCode: 500
      message: Unknown error occurred
      retryable: false
  retryable: [QUERY_TIMEOUT, REQUEST_LIMIT_EXCEEDED, API_CURRENTLY_DISABLED, BATCH_PROCESSING_ERROR, BATCH_LIMIT_EXCEEDED, CONNECTION_ERROR, TIMEOUT_ERROR]
  nonRetryable:
    [
      INVALID_SESSION_ID,
      INVALID_LOGIN,
      AUTHENTICATION_FAILED,
      OAUTH_ERROR,
      MALFORMED_QUERY,
      INVALID_FIELD,
      DUPLICATE_VALUE,
      REQUIRED_FIELD_MISSING,
      FIELD_CUSTOM_VALIDATION_EXCEPTION,
      STRING_TOO_LONG,
      INVALID_FIELD_FOR_INSERT_UPDATE,
      ENTITY_IS_DELETED,
      INVALID_ID_FIELD,
      ENTITY_IS_LOCKED,
      INSUFFICIENT_ACCESS_ON_CROSS_REFERENCE_ENTITY,
      INSUFFICIENT_ACCESS,
      NO_ACCESS,
      INVALID_TYPE,
      UNKNOWN_ERROR,
    ]

tests:
  enabled: true
  cleanup: true
  scenarios:
    - name: Account Operations
      description: Test account CRUD operations
      steps:
        - action: create
          resource: Account
        - action: retrieve
          resource: Account
        - action: update
          resource: Account
        - action: delete
          resource: Account
        - action: list
          resource: Account
    - name: Contact Operations
      description: Test contact CRUD operations
      steps:
        - action: create
          resource: Contact
        - action: retrieve
          resource: Contact
        - action: update
          resource: Contact
        - action: delete
          resource: Contact
        - action: list
          resource: Contact
    - name: Lead Operations
      description: Test lead CRUD and conversion
      steps:
        - action: create
          resource: Lead
        - action: retrieve
          resource: Lead
        - action: update
          resource: Lead
        - action: delete
          resource: Lead
    - name: Lead Conversion
      description: Test converting lead to account, contact, and opportunity
      steps:
        - action: create
          resource: Lead
        - action: retrieve
          resource: Lead
    - name: Opportunity Operations
      description: Test opportunity CRUD operations
      steps:
        - action: create
          resource: Opportunity
        - action: retrieve
          resource: Opportunity
        - action: update
          resource: Opportunity
        - action: list
          resource: Opportunity
    - name: Case Operations
      description: Test case CRUD operations
      steps:
        - action: create
          resource: Case
        - action: retrieve
          resource: Case
        - action: update
          resource: Case
    - name: Task Operations
      description: Test task CRUD operations
      steps:
        - action: create
          resource: Task
        - action: retrieve
          resource: Task
        - action: update
          resource: Task
    - name: Query Operations
      description: Test SOQL queries
      steps:
        - action: create
          resource: Account
        - action: list
          resource: Account
    - name: Search Operations
      description: Test SOSL searches
      steps:
        - action: create
          resource: Account
        - action: create
          resource: Contact
    - name: Bulk Operations
      description: Test bulk insert operations
      steps:
        - action: create
          resource: Account

docs:
  homepage: https://www.salesforce.com
  apiDocs: https://developer.salesforce.com/docs/atlas.en-us.api_rest.meta/api_rest/
  sdkDocs: https://jsforce.github.io/
  guides:
    quickstart: https://developer.salesforce.com/docs/atlas.en-us.api_rest.meta/api_rest/quickstart.htm
    authentication: https://developer.salesforce.com/docs/atlas.en-us.api_rest.meta/api_rest/intro_oauth_and_connected_apps.htm
    soql: https://developer.salesforce.com/docs/atlas.en-us.soql_sosl.meta/soql_sosl/
    bulk: https://developer.salesforce.com/docs/atlas.en-us.api_asynch.meta/api_asynch/
    streaming: https://developer.salesforce.com/docs/atlas.en-us.api_streaming.meta/api_streaming/
    webhooks: https://developer.salesforce.com/docs/atlas.en-us.api.meta/api/sforce_api_om_outboundmessaging.htm
---

# Salesforce Customer Relationship Management

Salesforce is the world's leading customer relationship management (CRM) platform. It provides a comprehensive suite of applications for sales, service, marketing, commerce, and more, all powered by a unified platform and data model.

## Features

- **Sales Cloud**: Lead and opportunity management, sales forecasting, account and contact management
- **Service Cloud**: Case management, knowledge base, customer service console
- **Marketing Cloud**: Email marketing, customer journeys, audience segmentation
- **Commerce Cloud**: E-commerce platform for B2C and B2B sales
- **Platform**: Custom applications, workflow automation, Lightning components
- **Analytics**: Einstein AI, reports and dashboards, predictive analytics
- **Integration**: REST/SOAP APIs, Bulk API, Streaming API, Platform Events
- **Mobile**: Salesforce mobile app with offline capabilities

## Quick Start

```typescript
import { SalesforceClient } from '@dotdo/sdk.do/integrations/salesforce'

// Create client with OAuth2
const salesforce = new SalesforceClient({
  instanceUrl: 'https://your-instance.salesforce.com',
  accessToken: process.env.SALESFORCE_ACCESS_TOKEN,
  version: '60.0',
})

// Create an account
const account = await salesforce.createAccount({
  Name: 'Acme Corporation',
  Type: 'Customer',
  Industry: 'Technology',
  Website: 'https://acme.com',
  Phone: '555-1234',
})

// Query records
const results = await salesforce.query("SELECT Id, Name, Industry FROM Account WHERE Industry = 'Technology' LIMIT 10")

// Create a contact
const contact = await salesforce.createContact({
  FirstName: 'John',
  LastName: 'Doe',
  Email: 'john.doe@acme.com',
  AccountId: account.Id,
})
```

## Authentication

### OAuth2 Flow (Recommended)

Set up a Connected App in Salesforce Setup:

1. **Setup → App Manager → New Connected App**
2. Enable OAuth Settings
3. Set callback URL and required scopes (api, refresh_token, full)
4. Get Consumer Key (Client ID) and Consumer Secret (Client Secret)

```typescript
// Step 1: Get authorization URL
const salesforce = new SalesforceClient({
  version: '60.0',
})

const authUrl = salesforce.getOAuth2AuthorizationUrl('your-client-id', 'https://your-app.com/oauth/callback', 'optional-state-parameter')

// Redirect user to authUrl...

// Step 2: Exchange authorization code for tokens
const result = await salesforce.oauth2Flow(authorizationCode, 'your-client-id', 'your-client-secret', 'https://your-app.com/oauth/callback')

console.log('Access Token:', result.accessToken)
console.log('Instance URL:', result.instanceUrl)
```

### Username/Password Authentication

For server-to-server integrations or development:

```typescript
const salesforce = new SalesforceClient({
  loginUrl: 'https://login.salesforce.com', // or 'https://test.salesforce.com' for sandbox
  version: '60.0',
})

// Login with username + password + security token
await salesforce.login('username@example.com', 'password' + 'securityToken')
```

**Security Token**: Get from Setup → Personal Setup → My Personal Information → Reset My Security Token

### Using Existing Tokens

```typescript
const salesforce = new SalesforceClient({
  instanceUrl: 'https://na1.salesforce.com',
  accessToken: process.env.SALESFORCE_ACCESS_TOKEN,
  refreshToken: process.env.SALESFORCE_REFRESH_TOKEN,
  clientId: process.env.SALESFORCE_CLIENT_ID,
  clientSecret: process.env.SALESFORCE_CLIENT_SECRET,
  version: '60.0',
})

// Refresh access token when expired
const result = await salesforce.refreshAccessToken()
```

## Resources

### Accounts

Accounts represent companies, organizations, or individuals you do business with.

```typescript
// Create an account
const account = await salesforce.createAccount({
  Name: 'Acme Corporation',
  Type: 'Customer',
  Industry: 'Technology',
  AnnualRevenue: 5000000,
  NumberOfEmployees: 150,
  Phone: '555-1234',
  Website: 'https://acme.com',
  BillingStreet: '123 Main St',
  BillingCity: 'San Francisco',
  BillingState: 'CA',
  BillingPostalCode: '94105',
  BillingCountry: 'USA',
})

// Get an account
const account = await salesforce.getAccount('001...')

// Update an account
await salesforce.updateAccount('001...', {
  Phone: '555-5678',
  Industry: 'Finance',
})

// Delete an account
await salesforce.deleteAccount('001...')

// List accounts with filters
const results = await salesforce.listAccounts({
  type: 'Customer',
  industry: 'Technology',
  limit: 100,
  orderBy: 'Name',
  order: 'ASC',
})

// Search accounts
const accounts = await salesforce.searchAccounts('Acme')
```

### Contacts

Contacts are individuals associated with accounts.

```typescript
// Create a contact
const contact = await salesforce.createContact({
  FirstName: 'John',
  LastName: 'Doe',
  Email: 'john.doe@example.com',
  Phone: '555-1234',
  AccountId: '001...', // Link to account
  Title: 'VP of Sales',
  Department: 'Sales',
})

// Get a contact
const contact = await salesforce.getContact('003...')

// Update a contact
await salesforce.updateContact('003...', {
  Email: 'newemail@example.com',
  MobilePhone: '555-5678',
})

// Delete a contact
await salesforce.deleteContact('003...')

// List contacts by account
const results = await salesforce.listContacts({
  accountId: '001...',
  limit: 50,
})

// Search contacts
const contacts = await salesforce.searchContacts('John Doe')
```

### Leads

Leads are prospective customers who haven't been qualified yet.

```typescript
// Create a lead
const lead = await salesforce.createLead({
  FirstName: 'Jane',
  LastName: 'Smith',
  Company: 'Smith Industries',
  Email: 'jane@smithindustries.com',
  Phone: '555-9999',
  Status: 'Open - Not Contacted',
  Rating: 'Hot',
  LeadSource: 'Web',
  Industry: 'Manufacturing',
})

// Get a lead
const lead = await salesforce.getLead('00Q...')

// Update a lead
await salesforce.updateLead('00Q...', {
  Status: 'Working - Contacted',
  Rating: 'Warm',
})

// Convert a lead to account, contact, and opportunity
const result = await salesforce.convertLead({
  leadId: '00Q...',
  convertedStatus: 'Closed - Converted',
  doNotCreateOpportunity: false,
  opportunityName: 'Smith Industries - New Deal',
})

console.log('Account ID:', result.accountId)
console.log('Contact ID:', result.contactId)
console.log('Opportunity ID:', result.opportunityId)

// Delete a lead
await salesforce.deleteLead('00Q...')

// List leads
const results = await salesforce.listLeads({
  status: 'Open - Not Contacted',
  rating: 'Hot',
  limit: 100,
})
```

### Opportunities

Opportunities represent qualified sales deals.

```typescript
// Create an opportunity
const opportunity = await salesforce.createOpportunity({
  Name: 'Big Deal',
  AccountId: '001...',
  Amount: 100000,
  StageName: 'Prospecting',
  CloseDate: '2025-12-31',
  Probability: 10,
  Type: 'New Customer',
  LeadSource: 'Partner Referral',
})

// Get an opportunity
const opportunity = await salesforce.getOpportunity('006...')

// Update an opportunity
await salesforce.updateOpportunity('006...', {
  StageName: 'Negotiation/Review',
  Probability: 75,
  Amount: 125000,
})

// Delete an opportunity
await salesforce.deleteOpportunity('006...')

// List opportunities
const results = await salesforce.listOpportunities({
  accountId: '001...',
  stageName: 'Prospecting',
  limit: 50,
})
```

### Cases

Cases represent customer support issues or inquiries.

```typescript
// Create a case
const caseRecord = await salesforce.createCase({
  Subject: 'Product not working',
  Description: 'Customer reports product is not functioning correctly',
  Status: 'New',
  Priority: 'High',
  Origin: 'Web',
  Type: 'Problem',
  AccountId: '001...',
  ContactId: '003...',
})

// Get a case
const caseRecord = await salesforce.getCase('500...')

// Update a case
await salesforce.updateCase('500...', {
  Status: 'Working',
  Priority: 'Medium',
})

// Delete a case
await salesforce.deleteCase('500...')

// List cases
const results = await salesforce.listCases({
  accountId: '001...',
  status: 'New',
  priority: 'High',
  limit: 100,
})
```

### Tasks

Tasks are activities or to-do items.

```typescript
// Create a task
const task = await salesforce.createTask({
  Subject: 'Follow up with customer',
  Description: 'Call customer to discuss requirements',
  Status: 'Not Started',
  Priority: 'Normal',
  ActivityDate: '2025-10-15',
  WhoId: '003...', // Contact or Lead ID
  WhatId: '001...', // Account, Opportunity, etc.
})

// Get a task
const task = await salesforce.getTask('00T...')

// Update a task
await salesforce.updateTask('00T...', {
  Status: 'Completed',
})

// Delete a task
await salesforce.deleteTask('00T...')

// List tasks
const results = await salesforce.listTasks({
  status: 'Not Started',
  priority: 'High',
  limit: 50,
})
```

### Custom Objects

Work with any Salesforce object, including custom objects:

```typescript
// Create a custom object record
const record = await salesforce.createRecord('CustomObject__c', {
  Name: 'Record Name',
  CustomField__c: 'Value',
  AnotherField__c: 123,
})

// Get a custom object record
const record = await salesforce.getRecord('CustomObject__c', 'a00...')

// Update a custom object record
await salesforce.updateRecord('CustomObject__c', 'a00...', {
  CustomField__c: 'Updated Value',
})

// Delete a custom object record
await salesforce.deleteRecord('CustomObject__c', 'a00...')
```

## SOQL Queries

SOQL (Salesforce Object Query Language) is similar to SQL for querying Salesforce data.

```typescript
// Simple query
const results = await salesforce.query("SELECT Id, Name, Industry FROM Account WHERE Industry = 'Technology' LIMIT 10")

console.log(`Found ${results.totalSize} accounts`)
results.records.forEach((account) => {
  console.log(account.Name, account.Industry)
})

// Query with pagination
let result = await salesforce.query('SELECT Id, Name FROM Account')
while (!result.done) {
  result.records.forEach((record) => console.log(record.Name))
  result = await salesforce.queryMore(result.nextRecordsUrl)
}

// Query with relationships
const results = await salesforce.query(`
  SELECT Id, Name, (SELECT Id, FirstName, LastName FROM Contacts)
  FROM Account
  WHERE Industry = 'Technology'
  LIMIT 5
`)

// Query with aggregate functions
const results = await salesforce.query(`
  SELECT Industry, COUNT(Id) AccountCount, AVG(AnnualRevenue) AvgRevenue
  FROM Account
  GROUP BY Industry
`)
```

## SOSL Searches

SOSL (Salesforce Object Search Language) searches across multiple objects.

```typescript
// Search across multiple objects
const results = await salesforce.search('FIND {Acme} IN NAME FIELDS RETURNING Account(Id, Name), Contact(Id, FirstName, LastName)')

console.log('Accounts:', results[0]?.records)
console.log('Contacts:', results[1]?.records)

// Search with filters
const results = await salesforce.search(`
  FIND {555-1234} IN PHONE FIELDS
  RETURNING Account(Id, Name, Phone WHERE Industry = 'Technology'),
            Contact(Id, Name, Phone WHERE Title = 'CEO')
`)
```

## Bulk Operations

Use bulk operations for processing large datasets (2,000+ records) efficiently:

```typescript
// Bulk insert
const accounts = [
  { Name: 'Company 1', Industry: 'Technology' },
  { Name: 'Company 2', Industry: 'Finance' },
  { Name: 'Company 3', Industry: 'Healthcare' },
  // ... up to 10,000 records per batch
]

const results = await salesforce.bulkInsert('Account', accounts)
results.forEach((result, index) => {
  if (result.success) {
    console.log(`Created account ${index}: ${result.id}`)
  } else {
    console.error(`Failed to create account ${index}:`, result.errors)
  }
})

// Bulk update
const updates = [
  { Id: '001...', Industry: 'Technology' },
  { Id: '001...', Industry: 'Finance' },
]
await salesforce.bulkUpdate('Account', updates)

// Bulk delete
const deletes = [{ Id: '001...' }, { Id: '001...' }]
await salesforce.bulkDelete('Account', deletes)
```

**Bulk API Limits**:

- Maximum 10,000 records per batch
- Maximum 10,000 batches per 24 hours
- 50% cost savings compared to REST API

## Metadata Operations

Introspect object and field metadata:

```typescript
// Describe an object
const metadata = await salesforce.describeObject('Account')
console.log('Object Name:', metadata.name)
console.log('Label:', metadata.label)
console.log('Queryable:', metadata.queryable)
console.log('Fields:', metadata.fields.length)

// List all fields
metadata.fields.forEach((field) => {
  console.log(`${field.name} (${field.type})`)
  if (field.picklistValues) {
    console.log(
      '  Picklist values:',
      field.picklistValues.map((v) => v.value)
    )
  }
})

// Describe all objects
const objects = await salesforce.describeGlobal()
objects.forEach((obj) => {
  console.log(`${obj.label} (${obj.name})`)
})
```

## Webhooks

### Setup

1. **Configure Outbound Messages** in Salesforce:
   - Setup → Process Automation → Workflow Rules
   - Create workflow with Outbound Message action
   - Set endpoint URL to your webhook handler

2. **Or use Platform Events**:
   - Setup → Integrations → Platform Events
   - Create custom Platform Event
   - Subscribe via Streaming API

### Signature Verification

```typescript
import { SalesforceWebhooks } from '@dotdo/sdk.do/integrations/salesforce'

// Verify webhook signature
const isValid = SalesforceWebhooks.verifySignature(
  requestBody, // Raw body as string
  request.headers['x-salesforce-signature'],
  process.env.SALESFORCE_WEBHOOK_SECRET
)

if (!isValid) {
  throw new Error('Invalid signature')
}
```

### Event Router

```typescript
import { EventRouter } from '@dotdo/sdk.do/integrations/salesforce'

const router = new EventRouter()

// Handle specific object events
router.on('Account:created', async (event) => {
  console.log('New account created:', event.data.Name)
})

router.on('Contact:updated', async (event) => {
  console.log('Contact updated:', event.recordId)
})

// Use wildcards
router.on('Account:*', async (event) => {
  console.log('Any account event:', event.type)
})

router.on('*:deleted', async (event) => {
  console.log('Record deleted:', event.objectType, event.recordId)
})

// Handle the event
await router.handle(event)
```

### Complete Webhook Handler

```typescript
import { createWebhookHandler, EventRouter } from '@dotdo/sdk.do/integrations/salesforce'

const router = new EventRouter()
router.on('Account:created', handleAccountCreated)
router.on('Contact:updated', handleContactUpdated)

const handler = createWebhookHandler(process.env.SALESFORCE_WEBHOOK_SECRET, router)

// In your HTTP handler:
app.post('/webhooks/salesforce', async (req, res) => {
  try {
    await handler(req.body, req.headers['x-salesforce-signature'])
    res.status(200).send('OK')
  } catch (error) {
    console.error('Webhook error:', error)
    res.status(400).send('Bad Request')
  }
})
```

## Streaming API

Subscribe to real-time events using Salesforce Streaming API:

### Change Data Capture

```typescript
import { StreamingAPI } from '@dotdo/sdk.do/integrations/salesforce'

const streaming = new StreamingAPI()

// Subscribe to Account changes
streaming.subscribe('/data/AccountChangeEvent', (event) => {
  console.log('Account changed:', event.type, event.recordId)
  console.log('Changed fields:', event.data)
})

// Subscribe to Contact changes
streaming.subscribe('/data/ContactChangeEvent', (event) => {
  console.log('Contact changed:', event.type, event.recordId)
})

// Handle streaming events (integrate with JSForce streaming)
const connection = salesforce.sdk
connection.streaming.topic('/data/AccountChangeEvent').subscribe((message) => {
  streaming.handleStreamingEvent('/data/AccountChangeEvent', message)
})
```

### Platform Events

```typescript
// Subscribe to custom Platform Event
streaming.subscribe('/event/OrderEvent__e', (event) => {
  console.log('Order event received:', event.data)
})

// Publish Platform Event
await salesforce.createRecord('OrderEvent__e', {
  OrderNumber__c: '12345',
  Status__c: 'Completed',
})
```

## Error Handling

```typescript
import { SalesforceIntegrationError } from '@dotdo/sdk.do/integrations/salesforce'

try {
  await salesforce.createAccount({ Name: 'Test' })
} catch (error) {
  if (error instanceof SalesforceIntegrationError) {
    console.error('Salesforce error:', error.code)
    console.error('Message:', error.message)
    console.error('Status:', error.statusCode)
    console.error('Type:', error.type)
    console.error('Fields:', error.fields)

    // Check if retriable
    if (error.isRetriable()) {
      console.log('Error is retriable, retrying...')
    }

    // Check if authentication error
    if (error.isAuthError()) {
      console.log('Authentication failed, please re-authenticate')
    }

    // Check if permission error
    if (error.isPermissionError()) {
      console.log('Insufficient permissions')
    }
  }
}
```

## Rate Limits

Salesforce enforces strict API limits:

**Daily Limits**:

- Professional Edition: 1,000 API calls/day
- Enterprise Edition: 5,000 API calls/day
- Unlimited Edition: 10,000 API calls/day

**Best Practices**:

- Use Bulk API for large datasets (2,000+ records)
- Batch queries to fetch multiple records at once
- Cache metadata and rarely-changing data
- Use SOQL queries instead of retrieving individual records

## Best Practices

### Query Optimization

```typescript
// ❌ Bad: Fetching all fields
const results = await salesforce.query('SELECT * FROM Account')

// ✅ Good: Only fetch needed fields
const results = await salesforce.query('SELECT Id, Name, Industry FROM Account')

// ✅ Good: Use indexes (filter by Id, Name, RecordType, etc.)
const results = await salesforce.query("SELECT Id, Name FROM Account WHERE Name LIKE 'Acme%' LIMIT 100")

// ✅ Good: Use selective filters
const results = await salesforce.query("SELECT Id, Name FROM Account WHERE Industry = 'Technology' AND CreatedDate > LAST_N_DAYS:30")
```

### Error Handling with Retry

```typescript
async function createAccountWithRetry(data, maxRetries = 3) {
  let lastError

  for (let i = 0; i < maxRetries; i++) {
    try {
      return await salesforce.createAccount(data)
    } catch (error) {
      lastError = error

      if (error instanceof SalesforceIntegrationError) {
        // Don't retry non-retriable errors
        if (!error.isRetriable()) {
          throw error
        }

        // Wait before retry (exponential backoff)
        await new Promise((resolve) => setTimeout(resolve, 1000 * Math.pow(2, i)))
      }
    }
  }

  throw lastError
}
```

### Automatic Token Refresh

```typescript
async function withTokenRefresh(fn) {
  try {
    return await fn()
  } catch (error) {
    if (error instanceof SalesforceIntegrationError && error.isAuthError()) {
      // Refresh token and retry
      await salesforce.refreshAccessToken()
      return await fn()
    }
    throw error
  }
}

// Use it:
const account = await withTokenRefresh(() => salesforce.getAccount('001...'))
```

## TypeScript Types

All operations are fully typed:

```typescript
import type { Account, Contact, Lead, Opportunity, Case, Task, QueryResult, DescribeResult, SalesforceEvent } from '@dotdo/sdk.do/integrations/salesforce'

// Type-safe account creation
const account: Account = await salesforce.createAccount({
  Name: 'Acme Corp',
  Industry: 'Technology',
})

// Type-safe query results
const results: QueryResult<Account> = await salesforce.query<Account>('SELECT Id, Name FROM Account')

// Type-safe event handling
router.on('Account:created', async (event: SalesforceEvent) => {
  const account = event.data as Account
  console.log(account.Name)
})
```

## Resources

- **Salesforce REST API**: https://developer.salesforce.com/docs/atlas.en-us.api_rest.meta/api_rest/
- **SOQL Reference**: https://developer.salesforce.com/docs/atlas.en-us.soql_sosl.meta/soql_sosl/
- **JSForce Documentation**: https://jsforce.github.io/
- **Bulk API 2.0**: https://developer.salesforce.com/docs/atlas.en-us.api_asynch.meta/api_asynch/
- **Streaming API**: https://developer.salesforce.com/docs/atlas.en-us.api_streaming.meta/api_streaming/
- **Platform Events**: https://developer.salesforce.com/docs/atlas.en-us.platform_events.meta/platform_events/
